<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>ç®¡ç†è€…ç”»é¢</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
    <h1>NYAç²¾ç®— ç®¡ç†è€…ç”»é¢</h1>
    <nav>
        <a href="/">ãƒ›ãƒ¼ãƒ </a> /
        <a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </nav>
</header>
<main class="admin-container">
    <aside class="admin-menu">
        <a href="/admin/users" class="menu-item">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a>
        <a href="/admin/requests" class="menu-item">ğŸ“‚ ç”³è«‹ç®¡ç†</a>
    </aside>

    <section class="admin-content">
        <div class="content-header">
            <h2>çµŒè²»ã‚µãƒãƒªãƒ¼</h2>
            <div class="total-expense">
                <span>ä¼šç¤¾å…¨ä½“ã®åˆè¨ˆçµŒè²»ï¼š</span>
                <strong th:text="'Â¥' + ${totalExpense}"></strong>
            </div>
        </div>
        <div class="chart-container">
            <div class="chart-box">
                <h3>æœˆåˆ¥çµŒè²»ã®æ¨ç§»</h3>
                <canvas id="summaryChart"></canvas>
                <p id="noDataMsg" style="text-align:center;color:#888;display:none;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
            </div>

            <div class="chart-box">
                <h3>ç”¨é€”åˆ¥çµŒè²»æ§‹æˆ</h3>
                <canvas id="reasonChart"></canvas>
            </div>
        </div>
    </section>
</main>
<script th:inline="javascript">
    /*<![CDATA[*/
    let summaryList = /*[[${summaryList}]]*/ [];
    let reasonList = /*[[${reasonList}]]*/ [];
    /*]]>*/

    // JSONæ–‡å­—åˆ—ã¨ã—ã¦æ¸¡ã•ã‚ŒãŸå ´åˆã®å¯¾å‡¦
    if (typeof summaryList === 'string') summaryList = JSON.parse(summaryList);
    if (typeof reasonList === 'string') reasonList = JSON.parse(reasonList);

    // ==== ãƒ‡ãƒ¼ã‚¿ãŒç„¡ã„ã¨ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ====
    if (!summaryList || summaryList.length === 0) {
        const msg = document.getElementById("noDataMsg");
        if (msg) msg.style.display = "block";
    }

    // ==== æœˆåˆ¥çµŒè²» ====
    const labels = (summaryList || []).map(item => item.month);
    const dataValues = (summaryList || []).map(item => item.totalAmount);

    new Chart(document.getElementById('summaryChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'æœˆåˆ¥çµŒè²»åˆè¨ˆï¼ˆå††ï¼‰',
                data: dataValues,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { display: false }
            },
            scales: { y: { beginAtZero: true } }
        }
    });

    // ==== ç”¨é€”åˆ¥çµŒè²» ====
    const reasonLabels = (reasonList || []).map(r => r.reason);
    const reasonValues = (reasonList || []).map(r => r.totalAmount);

    new Chart(document.getElementById('reasonChart'), {
        type: 'pie',
        data: {
            labels: reasonLabels,
            datasets: [{
                data: reasonValues,
                backgroundColor: [
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(255, 205, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(153, 102, 255, 0.7)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
</script>
<footer>
    <p>&copy;NYA</p>
</footer>
</body>
</html>